<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
 <head> 
  <script type="text/javascript">
function randomsort(a, b) {
    return Math.random() > 0.5 ? -1 : 1; //用Math.random()函数生成0~1之间的随机数与0.5比较，返回-1或1
}
function random(min, max) {
    return Math.floor(min + Math.random() * (max - min));
} //生成范围内随机数

var firstCol = -1;
var firstRow = -1;
var secondCol = -1;
var secondRow = -1;
var state = 0; //0为没选中，1为选中一张。
var c;
var ctx;
var imgArray = new Array();
var gameData = new Array();


var checkFlag=false;
var checkNum=0;
function init() {
	c=document.getElementById("myCanvas")
	ctx= c.getContext("2d");
    for (i = 0; i < 640 / 80; i++) {
        gameData[i] = new Array();
        for (j = 0; j < 960 / 60; j++) gameData[i][j] = -1;
    }
    //初始化游戏数据
    for (i = 1; i <= 10; i++) {
        var img = new Image();
        img.src = i + ".jpg";
        imgArray[i - 1] = img;
    }
}

function clickOnCanvas(event) {
    var x = event.offsetX;
    var y = event.offsetY;
    var colNum = Math.ceil(x / 60) - 1;
    var rowNum = Math.ceil(y / 80) - 1;
    console.debug("X 坐标: " + x + ", Y 坐标: " + y + " 列数: " + colNum + " 行数: " + rowNum);
    if (state == 0) {
        firstCol = colNum;
        firstRow = rowNum;
        state = 1;
    } else if (state = 1) {
        secondCol = colNum;
        secondRow = rowNum;
        state = 0;
        if (gameData[firstRow][firstCol] == gameData[secondRow][secondCol]) {
            console.debug("两次点击的是同一张图片,开始检查路径是否在三次拐弯内");
            if (checkPath(firstCol, firstRow, secondCol, secondRow)) {
                gameData[firstRow][firstCol] = -1;
                gameData[secondRow][secondCol] = -1;
            }
        } else {
            console.debug("两次点击不是同一张图片，进行处理");
        }
    }
    drawCanvas();
}
//检验路径，是否在三次拐弯内，true代表在三次拐弯内，false代表不在三次拐弯内
function checkPath(firstCol, firstRow, secondCol, secondPath) {

    return true;
}
function genGameData() {
    var dataPool = new Array();
    var poolSize = 0;
    for (i = 0; i < 640 / 80 / 2; i++) {
        for (j = 0; j < 960 / 60; j++) {
            var data = random( - 4, 9);
            gameData[i][j] = data;
            dataPool[poolSize++] = data;
        }
    }
    poolSize--;
    dataPool.sort(randomsort);
    for (i = 640 / 80 / 2; i < 640 / 80; i++) for (j = 0; j < 960 / 60; j++) {
        gameData[i][j] = dataPool[poolSize--];
    }
}
function startGame() {
    genGameData();
	drawCanvas();
}

function drawCanvas() {
    ctx.clearRect(0, 0, 960, 640);
    for (x = 0; x < 640 / 80; x++) for (y = 0; y < 960 / 60; y++) {
        var type = gameData[x][y];
        if (type >= 0) ctx.drawImage(imgArray[type], y * 60, x * 80);
        else continue;
    }

}
</script> 
 </head> 
 <body onload="init()"> 
  <div style="text-align:center;margin-right:auto;margin-left:auto;"> 
   <button onclick="startGame()">开始游戏</button> 
   <div> 
    <div style="margin-left:auto;margin-right:auto"> 
     <canvas id="myCanvas" width="960" height="640" onmousedown="clickOnCanvas(event)"></canvas> 
    </div> 
   </div>
  </div>
 </body>
</html>